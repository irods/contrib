# iRODS Docker Images

[iCAT server]: icat/Dockerfile
[iDrop server]: idrop-web2-tomcat7/Dockerfile
[bootstrap.sh]: icat/bootstrap.sh


### Background

The new schema for the iRODS Docker setup involves involves multiple containers interacting together:

* Postgres 9.4 stores the ICAT database
    * The password to this database is stored in `/etc/irods/setup_responses`
    * postgresql-client-9.4 is used in the icat container to interact with the database
* [iCAT server] is built on top of an [ubuntu:14.04](https://hub.docker.com/_/ubuntu/) docker image 
    * [kerberos](icat/krb5.conf) and [pam](icat/pam.sh) parameters are adapted from work done by [jonesa](http://github.com/jonesa)
    * [bootstrap.sh] is meant to have a directory mounted to `/export` which is the shared to other containers
    * The [export file](icat/.export) is used with `rsync` to copy the directory and parent directories to the `/export` folder then link the resulting files
    * [bootstrap.sh] will also reuse the `/export` directory if it exists
* [iDrop server] users the [tomcat:7-jre8](https://hub.docker.com/_/tomcat/) docker image
    * The [iDrop war](https://code.renci.org/gf/download/frsrelease/221/2530/idrop-web2.war) is downloaded and installed into tomcat webapps directory
    * The [java keytool](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html) is used to import the certificates generated by [bootstrap.sh]
* An apache ajp proxy is setup on the frontend using the [httpd](https://hub.docker.com/_/httpd/)
    * SSL is dependant on the certificates generated by [bootstrap.sh] 
    
### Requirements
* Docker-compose
* A stable internet connection
* AAFC domain account

### Starting server

After cloning the git:

```commandline
git clone  https://github.com/MikeKnowles/contrib
```

Run docker-compose:

```commandline
cd contrib/irods-docker
docker-compose up -d
```

### Caveats
* The export folder is an external volume mapped by docker compose to a folder named export in the current directory, this can be changed to appear elesewhere in [docker-compose.yml](docker-compose.yml)
* The export folder allows the iRODS instance to be restarted and keep all the same configuration and potentially move the files elsewhere
    * The [postgres:9.4](https://hub.docker.com/_/postgres/) docker image *must* be allowed to change permissions and owners in the export folder